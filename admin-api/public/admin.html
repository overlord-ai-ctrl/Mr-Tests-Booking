<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mr Tests - Admin Dashboard</title>
  <link rel="icon" type="image/png" href="/assets/MRTESTSLOGO.png?v=2">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png?v=outlined">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png?v=outlined">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png?v=outlined">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#4154f1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/admin/admin.css?v=e2e-unlock-test-fix">
</head>
<body>
  <div id="errBar" class="alert alert-danger d-none" role="alert"></div>
  <div class="container my-4">
    <header class="d-flex align-items-center justify-content-between bg-white py-3 px-3 rounded shadow-sm mb-3">
      <div class="d-flex align-items-center gap-2">
        <img src="/assets/MRTESTSLOGO.png?v=2" alt="Mr Tests Logo" class="logo" />
        <h1 class="h4 mb-0 text-primary">Mr Tests â€” Admin</h1>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div id="userBox" class="d-flex align-items-center gap-2" hidden>
          <span class="badge text-bg-primary" id="userRole" style="display:none"></span>
          <span id="userName" class="fw-semibold"></span>
          <span id="roleChip" class="role-chip d-none"></span>
        </div>
        <div id="topControls" class="ms-auto d-flex align-items-center gap-2">
          <button id="btnThemeTop" class="btn btn-sm btn-light" type="button" title="Toggle theme">ðŸŒ“</button>
          <button id="btnHelpTop" class="btn btn-sm btn-outline-info" type="button" title="Help">?</button>
        </div>
      </div>
    </header>

    <!-- Unlock panel -->
    <div id="unlockPanel" class="card p-3 mb-3">
      <div class="d-flex gap-2">
        <input id="unlockCode" class="form-control" placeholder="Enter admin code" autocomplete="off" />
        <button id="btnUnlock" class="btn btn-primary">Unlock</button>
      </div>
      <small id="unlockStatus" class="text-muted d-block mt-2"></small>
    </div>

    <!-- App (hidden until authed) -->
    <main id="app" hidden>
      <!-- Global error bar -->
      <div id="errBar" class="alert alert-danger d-none" role="alert"></div>

      <!-- Navigation -->
      <nav id="nav" class="nav nav-tabs mb-3">
        <a class="nav-link" data-nav="jobs"><i class="bi bi-kanban"></i> Jobs Board</a>
        <a class="nav-link" data-nav="myjobs"><i class="bi bi-briefcase"></i> My Jobs</a>
        <a class="nav-link" data-nav="centres"><i class="bi bi-geo-alt"></i> Preferred Test Centres</a>
        <a class="nav-link" data-nav="profile"><i class="bi bi-person-circle"></i> Profile</a>
        <a class="nav-link" data-nav="admins"><i class="bi bi-key"></i> Admin Codes</a>
        <a class="nav-link" data-nav="bookers"><i class="bi bi-people"></i> Bookers</a>
      </nav>

      <!-- Tab content containers -->
      <div id="jobs" class="page d-none"></div>
      <div id="myjobs" class="page d-none"></div>
      <div id="centres" class="page d-none"></div>
      <div id="profile" class="page d-none"></div>
      <div id="admins" class="page d-none"></div>
      <div id="bookers" class="page d-none"></div>
    </main>
  </div>

  <div id="toasty" class="toasty" aria-live="polite" aria-atomic="true"></div>
  
  <div id="screenBusy" class="screen-busy d-none" aria-live="assertive" aria-busy="true">
    <div class="screen-busy-box">
      <div class="spinner-border" role="status" aria-hidden="true"></div>
      <div id="screenBusyText" class="mt-2 fw-semibold">Workingâ€¦</div>
    </div>
  </div>

  <!-- Help panel -->
  <div id="helpPanel" class="help-panel d-none">
    <div class="help-content">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="mb-0">Quick Start Guide</h6>
        <button id="helpClose" class="btn btn-sm btn-outline-secondary">Ã—</button>
      </div>
      <ol class="help-steps">
        <li>Claim a job that matches your centres</li>
        <li>Propose a test & message the client</li>
        <li>When client confirms, complete the job</li>
      </ol>
    </div>
  </div>

  <!-- Onboarding wizard -->
  <div id="onboardModal" class="onb-modal d-none" role="dialog" aria-modal="true" aria-labelledby="onbTitle">
    <div class="onb-box">
      <h5 id="onbTitle" class="mb-3">Welcome â€“ let's set you up</h5>
      <div id="onbStepWrap"></div>
      <div class="onb-actions">
        <button id="onbBack" class="btn btn-outline-secondary">Back</button>
        <button id="onbNext" class="btn btn-primary">Next</button>
        <button id="onbFinish" class="btn btn-success d-none">Finish</button>
      </div>
    </div>
  </div>

  <!-- Load script (cache-bust) -->
  <script src="/admin/admin.js?v=e2e-unlock-test-fix2" defer></script>
  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/admin/sw.js')
          .then(registration => {
            console.log('SW registered: ', registration);
          })
          .catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }
  </script>
</body>
</html>