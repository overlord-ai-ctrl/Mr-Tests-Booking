<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mr Tests - Admin Dashboard</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png?v=outlined">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png?v=outlined">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png?v=outlined">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#4154f1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/admin/admin.css">
</head>
<body>
  <div class="container my-4">
    <header class="d-flex align-items-center justify-content-between bg-white py-3 px-3 rounded shadow-sm mb-3">
      <div class="d-flex align-items-center gap-2">
        <img src="/assets/MRTESTSLOGO.png" alt="Mr Tests Logo" class="logo" />
        <h1 class="h4 mb-0 text-primary">Mr Tests â€” Admin</h1>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div id="userBox" class="d-flex align-items-center gap-2" hidden>
          <span class="badge text-bg-primary" id="userRole" style="display:none"></span>
          <span id="userName" class="fw-semibold"></span>
        </div>
        <button id="helpToggle" class="btn btn-sm btn-outline-secondary me-2" title="Show help">?</button>
        <button id="darkModeToggle" class="btn btn-sm btn-outline-secondary" title="Toggle dark mode">ðŸŒ™</button>
      </div>
    </header>

    <!-- Auth gate -->
    <section id="authGate" class="panel card p-3 p-md-4 mb-3 auth">
      <div class="d-flex align-items-center gap-2 mb-3">
        <img src="/assets/MRTESTSLOGO.png" alt="Mr Tests Logo" class="logo" />
        <h2 class="mb-0">Enter admin code</h2>
      </div>
      <div class="row g-2 align-items-center mb-2">
        <div class="col-auto">
          <input id="token" type="password" placeholder="Admin code" class="form-control"/>
        </div>
        <div class="col-auto">
          <button id="unlock" class="btn btn-primary">Unlock</button>
        </div>
        <div class="col-auto">
          <span id="authStatus" class="form-text"></span>
        </div>
      </div>
      <p class="hint">Codes are personal. Your code decides which pages you see.</p>
    </section>

    <!-- App (hidden until authed) -->
    <main id="app" hidden>
      <div id="errBar" class="errbar d-none" role="alert">Something went wrong. Please try again.</div>
      <div id="netErr" class="alert alert-danger d-none">
        Network error. <button id="retryBtn" class="btn btn-sm btn-light">Retry</button>
      </div>
      <ul id="nav" class="nav nav-tabs mb-3" hidden>
        <li class="nav-item"><a class="nav-link active" data-nav="centres" href="#"><i class="bi bi-geo-alt me-2" aria-hidden="true"></i>Centres</a></li>
        <li class="nav-item"><a class="nav-link" data-nav="profile" href="#"><i class="bi bi-person-circle me-2" aria-hidden="true"></i>Profile</a></li>
        <li class="nav-item"><a class="nav-link" data-nav="jobs" href="#"><i class="bi bi-briefcase me-2" aria-hidden="true"></i>Find Jobs</a></li>
        <li class="nav-item"><a class="nav-link" data-nav="myjobs" href="#"><i class="bi bi-list-check me-2" aria-hidden="true"></i>My Claimed Jobs</a></li>
        <li class="nav-item"><a class="nav-link" data-nav="bookers" href="#"><i class="bi bi-people me-2" aria-hidden="true"></i>Bookers</a></li>
        <li class="nav-item"><a class="nav-link" data-nav="admins" href="#"><i class="bi bi-shield-lock me-2" aria-hidden="true"></i>Admin Codes</a></li>
      </ul>

      <section class="panel card p-3 p-md-4 mb-3" data-page="centres">
        <h2>Preferred Test Centres</h2>
        <div class="toolbar d-flex gap-2 align-items-center mb-2">
          <button id="toggleBin" class="btn btn-sm btn-outline-secondary">Recycle Bin</button>
          <span id="status" class="form-text ms-auto"></span>
        </div>
        <div id="centresBox" class="list">
          <div class="placeholder">Centres will appear hereâ€¦</div>
        </div>
        
        <div id="binPanel" class="mt-2" hidden>
          <div id="binList" class="list"></div>
          <span id="binStatus" class="form-text"></span>
        </div>
        
        <h3>Add a new centre</h3>
        <div class="row g-2 align-items-center mb-2">
          <div class="col-auto">
            <input id="newName" type="text" placeholder="Name e.g. London - Wood Green" class="form-control"/>
          </div>
          <div class="col-auto">
            <button id="append" class="btn btn-primary">Append</button>
          </div>
          <div class="col-auto">
            <span id="appendStatus" class="form-text"></span>
          </div>
        </div>
        
        <h3>My coverage</h3>
        <div id="myCoverageBox" class="list"><div class="placeholder">Load centres firstâ€¦</div></div>
        <div class="row g-2 align-items-center mb-2">
          <div class="col-auto">
            <button id="saveCoverage" class="btn btn-primary">Save my coverage</button>
          </div>
          <div class="col-auto">
            <span id="coverageStatus" class="form-text"></span>
          </div>
        </div>
      </section>

      <section class="panel card p-3 p-md-4 mb-3" data-page="profile" hidden>
        <p class="text-muted mb-3"><small>Set your name and coverage so matching jobs appear.</small></p>
        <div class="profile-header">
          <div>
            <div class="profile-name" id="profileName">â€”</div>
            <div class="profile-sub">
              <span class="badge" id="profileRole">â€”</span>
              <label class="switch">
                <input type="checkbox" id="profileAvailable">
                <span>Available</span>
              </label>
            </div>
          </div>
          <div class="profile-stats">
            <div class="stat">
              <div class="stat-num" id="profileLifetime">0</div>
              <div class="stat-label">Lifetime jobs</div>
            </div>
          </div>
        </div>
        <div class="row g-2 align-items-center mb-2">
          <div class="col-auto">
            <textarea id="profileNotes" placeholder="Notesâ€¦" rows="3" class="form-control"></textarea>
          </div>
          <div class="col-auto">
            <button id="saveProfile" class="btn btn-primary">Save profile</button>
          </div>
          <div class="col-auto">
            <span id="profileStatus" class="form-text"></span>
          </div>
        </div>
        <div class="mt-3">
          <h4>Preferred Test Centres</h4>
          <ul id="profileCentres" class="clean-list"></ul>
        </div>
      </section>

      <section class="panel card p-3 p-md-4 mb-3" data-page="admins" hidden>
        <h2>Admin Codes</h2>
        <div id="codesList" class="list"><div class="placeholder">Codes will appear hereâ€¦</div></div>

        <h3>Add a new admin</h3>
        <div class="row g-2 align-items-center mb-2">
          <div class="col-auto">
            <input id="newCode" type="text" placeholder="Code (e.g. 7777 or alice-1)" class="form-control"/>
          </div>
          <div class="col-auto">
            <input id="newAdminName" type="text" placeholder="Name e.g. Alice" class="form-control"/>
          </div>
          <div class="col-auto">
            <select id="newRole" class="form-control">
              <option value="booker">Booker</option>
              <option value="master">Master admin</option>
            </select>
          </div>
          <div class="col-auto">
            <button id="addCode" class="btn btn-primary">Add code</button>
          </div>
          <div class="col-auto">
            <span id="addCodeStatus" class="form-text"></span>
          </div>
        </div>
      </section>

      <section class="panel card p-3 p-md-4 mb-3" data-page="jobs" hidden>
        <p class="text-muted mb-3"><small>Claim a job that matches your centres. Details unlock after you claim.</small></p>
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h5 mb-0">Find Jobs</h2>
          <div class="text-end">
            <span id="jobsStatus" class="form-text"></span>
          </div>
        </div>
        <div class="row g-2 align-items-center mb-2">
          <div class="col-auto">
            <input id="jobsSearch" class="form-control" type="text" placeholder="Search centre or candidate">
          </div>
          <div class="col-auto" id="jobCreate" hidden>
            <!-- master-only quick create (leave IDs if you already have fields; otherwise keep as-is) -->
            <button id="createJob" class="btn btn-sm btn-primary"><i class="bi bi-plus-lg me-1"></i>Create job</button>
            <span id="createJobStatus" class="form-text"></span>
          </div>
        </div>
        <div id="jobsList" class="list"></div>
      </section>

      <section class="panel card p-3 p-md-4 mb-3" data-page="myjobs" hidden>
        <p class="text-muted mb-3"><small>Propose a test, message the client, then mark as completed.</small></p>
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h5 mb-0">My Claimed Jobs</h2>
          <span id="myJobsStatus" class="form-text"></span>
        </div>
        <div id="myJobsList" class="list"></div>
        <div class="mt-2">
          <span id="earnings" class="fw-semibold"></span>
        </div>
      </section>

      <section class="panel card p-3 p-md-4 mb-3" data-page="bookers" hidden>
        <p class="text-muted mb-3"><small>View and manage booker workloads and assignments.</small></p>
        <div class="row g-3">
          <div class="col-12 col-lg-4">
            <label class="form-label">Select booker</label>
            <select id="bookerPicker" class="form-select"></select>
            <div id="bookerMeta" class="mt-2"></div>
          </div>
          <div class="col-12 col-lg-8">
            <div id="bookerJobs"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="toasty" class="toasty" aria-live="polite" aria-atomic="true"></div>
  
  <div id="screenBusy" class="screen-busy d-none" aria-live="assertive" aria-busy="true">
    <div class="screen-busy-box">
      <div class="spinner-border" role="status" aria-hidden="true"></div>
      <div id="screenBusyText" class="mt-2 fw-semibold">Workingâ€¦</div>
    </div>
  </div>

  <!-- Help panel -->
  <div id="helpPanel" class="help-panel d-none">
    <div class="help-content">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="mb-0">Quick Start Guide</h6>
        <button id="helpClose" class="btn btn-sm btn-outline-secondary">Ã—</button>
      </div>
      <ol class="help-steps">
        <li>Claim a job that matches your centres</li>
        <li>Propose a test & message the client</li>
        <li>When client confirms, complete the job</li>
      </ol>
    </div>
  </div>

  <!-- Onboarding wizard -->
  <div id="onboardModal" class="onb-modal d-none" role="dialog" aria-modal="true" aria-labelledby="onbTitle">
    <div class="onb-box">
      <h5 id="onbTitle" class="mb-3">Welcome â€“ let's set you up</h5>
      <div id="onbStepWrap"></div>
      <div class="onb-actions">
        <button id="onbBack" class="btn btn-outline-secondary">Back</button>
        <button id="onbNext" class="btn btn-primary">Next</button>
        <button id="onbFinish" class="btn btn-success d-none">Finish</button>
      </div>
    </div>
  </div>

  <script src="/admin/admin.js" defer></script>
</body>
</html>
